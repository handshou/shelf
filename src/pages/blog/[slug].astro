---
import type { Posts } from "tina/__generated__/types";
import { client } from "../../../tina/__generated__/client";
import { isAdmin as isAdminUrl } from "@/lib/tina";

import Backtrack from "@ac/Backtrack.astro";
import BaseLayout from "@layouts/Safari.astro";
import { PostComponent } from "@rc/posts";

Astro.response.headers.set("Cache-Control", "max-age=0");
Astro.response.headers.set("Cache-Control", "s-maxage=0");

const { slug } = Astro.params;
const { host, referer } = Astro.locals;

const isAdmin = isAdminUrl({ host, referer });
const response = await client.queries.posts({ relativePath: `${slug}.mdx` });
const post = response.data.posts as Posts;

if (!post.published && !isAdmin) {
  return Astro.redirect("/404");
}
---
<style>
  .sticky {
    position: sticky;
    top: 0;
    overflow: hidden;
    background-color: #eee;
  }
</style>
<BaseLayout content={{ title: post.title, description: post.description }}>
  <div class="sticky">
    <Backtrack url="/blog" title="back to ðŸª´ garden" />
  </div>
  {/* @ts-ignore */}
  <PostComponent client:tina {...response} />
</BaseLayout>
