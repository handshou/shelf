---
import { getEntry } from 'astro:content'
import { client } from '../../../tina/__generated__/client'
import { PostComponent } from '../../components/posts'
import BaseLayout from '../../layouts/BlogPost.astro'

Astro.response.headers.set('Cache-Control', 'max-age=0')
Astro.response.headers.set('Cache-Control', 's-maxage=0')

const { slug } = Astro.params

const posts = await getEntry('posts', slug)

if (posts === undefined) {
	return Astro.redirect('/404')
}

const response = await client.queries.posts({ relativePath: `${slug}.mdx` })
---

<BaseLayout content={posts.data}>
    <PostComponent client:tina {...response} />
</BaseLayout>
